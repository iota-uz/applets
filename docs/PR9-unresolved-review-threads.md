# PR #9 — Unresolved review threads only

Fetched via GitHub GraphQL: `reviewThreads` where `isResolved == false`.  
[PR link](https://github.com/iota-uz/applets/pull/9)

---

## 1. ChartCard.tsx (line 186) — Major

**Issue:** `richOptions` is recomputed every render, breaking downstream `useMemo` hooks.

**Fix:** Wrap in `useMemo`:
```ts
const richOptions = useMemo(
  () => (isRecord(chartData.options) ? cloneDeep(chartData.options) : null),
  [chartData.options]
)
```

---

## 2. ChartCard.tsx (line 228) — Minor

**Issue:** Dropping non-finite data points (map to null then filter) may misalign series with x-axis labels.

**Fix:** Preserve `null` values (ApexCharts supports gaps). Remove the `.filter((v): v is number => v !== null)` on the data array; change the `.filter((item) => item.data.length > 0)` to allow series with at least one non-null value.

---

## 3. FullscreenOverlay.tsx (line 53) — Minor

**Issue:** Redundant `<span className="sr-only">{title}</span>` — screen readers announce the dialog title twice (aria-label on the div already names it).

**Fix:** Remove the `<span className="sr-only">{title}</span>` inside the dialog div.

---

## 4. UserMessage.tsx (line 122) — Minor

**Issue:** `isCopied` copy-feedback may be invisible on hover devices because plain `opacity-100` loses to `[@media(hover:hover)]:opacity-0` in cascade.

**Fix:** Use a data-attribute: add `[data-copied='true']:opacity-100` (with same media variant) to the `actions` class, and set `data-copied={isCopied ? 'true' : undefined}` on the container instead of appending `opacity-100`.

---

## 5. HttpDataSource.ts (line 210) — Minor

**Issue:** `stopGeneration` only signals the server; it doesn’t abort the local SSE/fetch, so callers can still receive tokens.

**Fix:** Either abort the local controller inside `stopGeneration` (e.g. `this.abortController?.abort()`) or document that callers must abort the signal / call `cancelStream()` alongside `stopGeneration()`.

---

## 6. MessageTransport.ts (line 183) — Major

**Issue:** No timeout on the `/stop` request — caller can hang indefinitely if the endpoint is slow or unreachable.

**Fix:** Add `AbortSignal.timeout(deps.timeout)` (or a manual AbortController + setTimeout) to the stop `fetch`, and handle timeout/abort like the non-OK branch.

---

## 7. useStreaming.ts (line 57) — Major

**Issue:** Using `[core]` as dependency defeats memoization; `useCoreStreaming()` returns a new object each render.

**Fix:** Use stable method refs: `[core.processStream]`, `[core.cancel]`, `[core.reset]` in the three `useCallback` dependency arrays.

---

## 8. DebugPanel.tsx (line 369) — Minor

**Issue:** "Open in Langfuse" is hardcoded; misleading if trace URL points to another backend (e.g. Datadog, Jaeger).

**Fix:** Derive label from URL hostname (e.g. "Open in Langfuse" when host includes `langfuse`, else `Open trace (${host})`), with fallback "Open trace" on parse error.

---

## 9. TabbedChartGroup.tsx (line 49) — Minor

**Issue:** Missing focus restoration when exiting fullscreen; focus is moved to container on enter but not restored on Escape/backdrop click.

**Fix:** Save `document.activeElement` before `containerRef.current?.focus()`, and in the effect cleanup (and when exiting fullscreen) call `previousFocusRef.current?.focus()`.

---

## 10. mappers.ts (line 857) — Critical

**Issue:** Mutating shared `charts` array — `nextTurns` shallow-copies `assistantTurn` but `charts` is not cloned; `.push(chart)` mutates the original turn’s array.

**Fix:** When building the shallow copy (around 796–803), set `charts: turn.assistantTurn.charts ? [...turn.assistantTurn.charts] : undefined` and `renderTables: turn.assistantTurn.renderTables ? [...turn.assistantTurn.renderTables] : undefined` so modifications don’t affect the original.

---

*Generated by filtering `reviewThreads` with `isResolved == false`.*
